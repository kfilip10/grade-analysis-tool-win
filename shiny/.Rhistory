ggplot(lab_grade_pct, aes(grade, pct, fill = lab_bin)) +
geom_col(position = position_dodge(width = 0.7),width = 0.6) +
geom_text(aes(label = label),
position = position_dodge(width = 0.7),
vjust = -0.35, size = 4.5) +
scale_fill_manual(values = c("Labs - Ind" = "#4CAF50",   # green
"Labs - Grp"   = "#A9A9A9"))+  # grey
scale_y_continuous(
labels = percent,
expand = expansion(mult = c(0, 0.1))   # a little head-room
) +
labs(
title = "Grade distribution in Lab Program AY 25-2",
x = "Letter grade",
y = "Percent of students",
fill = ""
) +
theme_minimal(base_size = 16) +
theme(legend.position = "bottom")
ggsave(
filename = "Lab Grade Summary AY25-2.png",
device = "png",
path = wd,
width = 8,
height = 4,
units = "in",
dpi = 300
)
# 3. Plot
ggplot(lab_grade_pct, aes(grade, pct, fill = lab_bin)) +
geom_col(position = position_dodge(width = 0.7),width = 0.6) +
geom_text(aes(label = label),
position = position_dodge(width = 0.7),
vjust = -0.35, size = 4.5) +
scale_fill_manual(values = c("Labs - Ind" = "#4CAF50",   # green
"Labs - Grp"   = "#A9A9A9"))+  # grey
scale_y_continuous(
labels = percent,
expand = expansion(mult = c(0, 0.1))   # a little head-room
) +
labs(
title = "Grade distribution in Lab Program AY 25-2",
x = "Letter grade",
y = "Percent of students",
fill = ""
) +
theme_bw(base_size = 16) +
theme(legend.position = "bottom")
ggsave(
filename = "Lab Grade Summary AY25-2.png",
device = "png",
path = wd,
width = 8,
height = 4,
units = "in",
dpi = 300
)
shiny::runApp()
sections <- lapply(course_list_df$id, function(x) {
incProgress(1 / length(unique(course_list_df$id)),
detail = paste("Loading course data for course", x)
)
get_section_info(x, include = "total_students")
})
course_list_df %>% filter(id=9882)
course_list_df %>% filter(id==9882)
course_list_df %>% filter(id==10429)
course_list_df %>% filter(id==9882)
course_list_df %>% filter(id==9883)
saveRDS(course_list_df,test.rds)
# library(rcanvas)
library(dplyr)
library(httr)
library(jsonlite)
library(tidyr)
library(stringr)
library(pbapply) # progress bar for *apply family
library(purrr)
library(tibble)
library(uuid) # for generating UUIDs
library(readxl)
source("canvas_api_R/api access.R")
shiny::runApp()
shiny::runApp()
df <- course_list_df() %>%
filter(id %in% selected_courses()$idget_student_roster(
# message to user to select assignments
roster_course_df(),
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
course_list_df()
df <- course_list_df() %>%
filter(id %in% selected_courses()$id
get_student_roster(
df <- course_list_df() %>% filter(id %in% selected_courses()$id
get_student_roster(
df <- course_list_df() %>% filter(id %in% selected_courses()$id
get_student_roster(df,
df <- course_list_df() %>% filter(id %in% selected_courses()$id)
selected_courses()
df <- course_list_df() %>% filter(section_id %in% selected_courses()$section_id)
get_student_roster(df,
# message to user to select assignments
roster_course_df(),
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
)
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
roster.course <- roster_course_df()
View(roster.course)
shiny::runApp()
#improves search down to the actual selected
df <- course_list_df() %>% filter(section_id %in% selected_courses()$section_id)
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
shiny::runApp()
#improves search down to the actual selected
df <- course_list_df() %>% filter(section_id %in% selected_courses()$section_id)
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
shiny::runApp()
#improves search down to the actual selected
df <- course_list_df() %>% filter(section_id %in% selected_courses()$section_id)
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
shiny::runApp()
#improves search down to the actual selected
df <- course_list_df() %>% filter(section_id %in% selected_courses()$section_id)
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
roster.course <- roster_course_df()
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
roster.course <- roster_course_df()
#improves search down to the actual selected
df <- course_list_df() %>% filter(id %in% selected_courses()$id)
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
roster.course <- roster_course_df()
shiny::runApp()
#improves search down to the actual selected
df <- course_list_df() %>% filter(id %in% selected_courses()$id)
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
roster.course <- roster_course_df()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
#improves search down to the actual selected
df <- course_list_df() %>% filter(section_id %in% selected_courses()$section_id)
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
shiny::runApp()
#improves search down to the actual selected
df <- course_list_df() %>% filter(section_id %in% selected_courses()$section_id)
roster_course_df(
get_student_roster(df,
# message to user to select assignments
canvas_errorlist, INSTRUCTOR_SEARCH_KEY
))
shiny::runApp()
shiny::runApp()
force(course_df)
force(error_list)
force(instructor.search.key)
# error_list definition
enrollment.list <- lapply(unique(course_df$id), function(x, i) {
incProgress(1 / length(unique(course_df$id)))
tryCatch(
{
get_course_items(course_id = x, item = "enrollments", include = "current_points")
},
error = function(e) {
# Append error message to the reactive list
current_errors <- error_list
error_list(c(current_errors, list(paste("Error processing course ID:", x, "->", e$message))))
return(NULL) # Return NULL for failed courses
}
)
}, i = seq_along(course_df))
get_course_items(course_id = 9882, item = "enrollments", include = "current_points")
items <- get_course_items(course_id = 9882, item = "enrollments", include = "current_points")
shiny::runApp()
force(course_df)
items <- get_course_items(course_id = 9882, item = "enrollments", include = "current_points")
shiny::runApp()
shiny::runApp()
items <- get_course_items(course_id = 9882, item = "enrollments", include = "current_points")
shiny::runApp()
items <- get_course_items(course_id = 9882, item = "enrollments", include = "current_points")
View(items)
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
colnames(cuts_df_filtered) <- c("V", "Q", "Name", "Pts", "Cut", "% Applied", "Question")
cuts_flextable <- flextable(cuts_df_filtered %>% select(`#`, Pts, Cut, `Applied (%)`)) %>%
theme_vanilla() %>%
bold(part = "header", bold = TRUE) %>% # Bold the headers
fontsize(size = 13, part = "all") %>% # Set font size for entire table
align(j = c("Question", "Cut"), align = "left", part = "all") %>% # Left-align the 'Cut' column
align(j = c("Pts", "% Applied"), align = "center", part = "all") %>%
autofit() %>%
padding(padding = 2.5, part = "all") %>%
height_all(height = 0.1, part = "all") #
cuts_flextable <- flextable(cuts_df_filtered %>% select(`Question`, Pts, Cut, `Applied (%)`)) %>%
theme_vanilla() %>%
bold(part = "header", bold = TRUE) %>% # Bold the headers
fontsize(size = 13, part = "all") %>% # Set font size for entire table
align(j = c("Question", "Cut"), align = "left", part = "all") %>% # Left-align the 'Cut' column
align(j = c("Pts", "% Applied"), align = "center", part = "all") %>%
autofit() %>%
padding(padding = 2.5, part = "all") %>%
height_all(height = 0.1, part = "all") #
cuts_flextable <- flextable(cuts_df_filtered %>% select(`Question`, Pts, Cut, `% Applied`)) %>%
theme_vanilla() %>%
bold(part = "header", bold = TRUE) %>% # Bold the headers
fontsize(size = 13, part = "all") %>% # Set font size for entire table
align(j = c("Question", "Cut"), align = "left", part = "all") %>% # Left-align the 'Cut' column
align(j = c("Pts", "% Applied"), align = "center", part = "all") %>%
autofit() %>%
padding(padding = 2.5, part = "all") %>%
height_all(height = 0.1, part = "all") #
return(cuts_flextable)
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
force(df_canvas_adj)
View(df_canvas_adj)
### Pre/post table ----
pre_stats <- df_canvas_adj %>%
mutate(
pre_percent = pre_percent,
post_percent = post_percent,
mge_percent = mge_percent
) %>%
summarise(
Type = "Pre",
Number = n(),
Average = mean(pre_percent),
Median = median(pre_percent),
Min = min(pre_percent),
Max = max(pre_percent)
)
post_stats <- df_canvas_adj %>%
mutate(
post_percent = post_percent,
mge_percent = mge_percent
) %>%
summarise(
Type = "Post",
Number = n(),
Average = mean(post_percent),
Median = median(post_percent),
Min = min(post_percent),
Max = max(post_percent)
)
comp.stats <- rbind(pre_stats, post_stats)
comp_stats_ft <- comp.stats %>%
flextable() %>%
align_nottext_col(align = "center") %>%
fontsize(size = 16, part = "header") %>%
autofit() %>%
fontsize(size = 18) %>%
align_text_col(align = "center") %>%
colformat_double(digits = 1) %>%
set_caption(as_paragraph(
as_chunk("Pre/Post Score Comparisons", props = caption_style)
), word_stylename = "Table Caption")
# show(comp_stats_ft)
### table grades ----
grade_summary <- df_canvas_adj %>%
reframe(
grade = unique(c(pre_grade, post_grade)), # Combine all unique grades
pre_count = sapply(grades.desc, function(g) sum(pre_grade == g)),
post_count = sapply(grades.desc, function(g) sum(post_grade == g))
) %>%
mutate(
percent_change = round((post_count - pre_count) / pre_count * 100, 0)
) %>%
mutate(grade = factor(grade, levels = grades)) %>%
arrange(grade)
colnames(grade_summary)[1] <- "Grade"
colnames(grade_summary)[2] <- "Pre Count"
colnames(grade_summary)[3] <- "Post Count"
colnames(grade_summary)[4] <- "Percent Change"
# Transpose the table
transposed_summary <- t(grade_summary)
colnames(transposed_summary) <- transposed_summary[1, ] # Set column names to the grades
transposed_summary <- transposed_summary[-1, , drop = FALSE] # Remove the first row used for column names
# Convert the transposed table to a data frame
transposed_df <- as.data.frame(transposed_summary, stringsAsFactors = FALSE)
# Add the row names as a column for `flextable`
transposed_df <- transposed_df %>%
rownames_to_column(var = "Grade")
# Create a color matrix for the transposed data frame
colormatrix <- apply(transposed_df[, -1], 1:2, function(x) {
if (!is.na(as.numeric(x))) { # Check if the value can be converted to numeric
ifelse(as.numeric(x) < 0, "#FDEFEF", "#F4FFEF") # Red for negative, green for positive
} else {
"#FFFFFF" # White for non-numeric cells
}
})
# writes the first two rows as white
colormatrix[1:2, ] <- "white"
colormatrix[3, 1] <- "white"
transposed_df[3, 1:ncol(transposed_df)] <- paste0(as.character(transposed_df[3, 1:ncol(transposed_df)]), "%")
# Apply the color matrix in a flextable
comp_grades_ft <- transposed_df %>%
flextable() %>%
bg(i = seq_len(nrow(transposed_df)), j = seq_len(ncol(transposed_df) - 1), bg = colormatrix) %>% # Apply colors
align_nottext_col(align = "center") %>%
align_text_col(align = "center") %>%
fontsize(size = 20, part = "header") %>%
fontsize(size = 18) %>%
set_caption(
as_paragraph(
as_chunk("Pre/Post Grade Comparisons", props = caption_style)
),
word_stylename = "Table Caption"
)
View(transposed_summary)
View(df_canvas_adj)
View(grade_summary)
df_canvas_adj %>%
reframe(
grade = unique(c(pre_grade, post_grade)), # Combine all unique grades
pre_count = sapply(grades.desc, function(g) sum(pre_grade == g)),
post_count = sapply(grades.desc, function(g) sum(post_grade == g))
)
grades.desc
### table grades ----
grade_summary2 <- df_canvas_adj %>%
reframe(
grade = unique(c(pre_grade, post_grade)))
View(grade_summary2)
### table grades ----
grade_summary2 <- df_canvas_adj %>%
reframe(
grade = unique(c(pre_grade, post_grade)),
pre_count = sapply(grades.desc, function(g) sum(pre_grade == g)))
View(grade_summary2)
View(df_canvas_adj)
sum(grade_summary2$pre_count)
### table grades ----
grade_levels <- grades.desc
grade_summary2 <- tibble(
grade      = grade_levels,
pre_count  = sapply(grade_levels, \(g) sum(df_canvas_adj$pre_grade  == g, na.rm = TRUE)),
post_count = sapply(grade_levels, \(g) sum(df_canvas_adj$post_grade == g, na.rm = TRUE))
)
View(grade_summary2)
View(transposed_df)
grade_summary <- tibble(
grade      = grade_levels,
pre_count  = sapply(grade_levels, \(g) sum(df_canvas_adj$pre_grade  == g, na.rm = TRUE)),
post_count = sapply(grade_levels, \(g) sum(df_canvas_adj$post_grade == g, na.rm = TRUE))
)
View(grade_summary)
grade_summary2 <- df_canvas_adj %>%
reframe(
grade = unique(c(pre_grade, post_grade)),
pre_count = sapply(grades.desc, function(g) sum(pre_grade == g)))
View(grade_summary2)
grade_summary2 <- df_canvas_adj %>%
reframe(
grade = unique(c(pre_grade, post_grade)), # Combine all unique grades
pre_count = sapply(grades.desc, function(g) sum(pre_grade == g)),
post_count = sapply(grades.desc, function(g) sum(post_grade == g))
) %>%
mutate(
percent_change = round((post_count - pre_count) / pre_count * 100, 0)
) %>%
mutate(grade = factor(grade, levels = grades)) %>%
arrange(grade)
View(grade_summary2)
View(grade_summary)
View(grade_summary2)
View(grade_summary)
View(grade_summary2)
### table grades ----
grade_levels <- rev(grades.desc)  # reverse to go F â†’ A
grade_summary2 <- df_canvas_adj %>%
mutate(
pre_grade  = factor(pre_grade,  levels = grade_levels),
post_grade = factor(post_grade, levels = grade_levels)
) %>%
summarise(
pre_count  = tabulate(pre_grade,  nbins = length(grade_levels)),
post_count = tabulate(post_grade, nbins = length(grade_levels))
) %>%
as_tibble() %>%
mutate(
grade = grade_levels,
percent_change = 100 * (post_count - pre_count) / pmax(pre_count, 1)
) %>%
select(grade, pre_count, post_count, percent_change)
grade_summary <- df_canvas_adj %>%
mutate(
pre_grade  = factor(pre_grade,  levels = grade_levels),
post_grade = factor(post_grade, levels = grade_levels)
) %>%
summarise(
pre_count  = tabulate(pre_grade,  nbins = length(grade_levels)),
post_count = tabulate(post_grade, nbins = length(grade_levels))
) %>%
as_tibble() %>%
mutate(
grade = grade_levels,
percent_change = 100 * (post_count - pre_count) / pmax(pre_count, 1)
) %>%
select(grade, pre_count, post_count, percent_change)
grade_summary2 <- df_canvas_adj %>%
reframe(
grade = unique(c(pre_grade, post_grade)), # Combine all unique grades
pre_count = sapply(grades.desc, function(g) sum(pre_grade == g)),
post_count = sapply(grades.desc, function(g) sum(post_grade == g))
) %>%
mutate(
percent_change = round((post_count - pre_count) / pre_count * 100, 0)
) %>%
mutate(grade = factor(grade, levels = grades)) %>%
arrange(grade)
View(grade_summary)
View(grade_summary2)
View(grade_summary)
View(grade_summary2)
View(grade_summary)
View(grade_summary2)
View(grade_summary)
View(grade_summary2)
View(grade_summary)
View(grade_summary2)
View(grade_summary)
grade_summary <- df_canvas_adj %>%
mutate(
pre_grade  = factor(pre_grade,  levels = grade_levels),
post_grade = factor(post_grade, levels = grade_levels)
) %>%
summarise(
pre_count  = tabulate(pre_grade,  nbins = length(grade_levels)),
post_count = tabulate(post_grade, nbins = length(grade_levels))
) %>%
as_tibble() %>%
mutate(
grade = grade_levels,
percent_change = round(100 * (post_count - pre_count) / pmax(pre_count, 1),0)
) %>%
select(grade, pre_count, post_count, percent_change)
grade_summary <- df_canvas_adj %>%
mutate(
pre_grade  = factor(pre_grade,  levels = grade_levels),
post_grade = factor(post_grade, levels = grade_levels)
) %>%
reframe(
pre_count  = tabulate(pre_grade,  nbins = length(grade_levels)),
post_count = tabulate(post_grade, nbins = length(grade_levels))
) %>%
as_tibble() %>%
mutate(
grade = grade_levels,
percent_change = round(100 * (post_count - pre_count) / pmax(pre_count, 1),0)
) %>%
select(grade, pre_count, post_count, percent_change)
View(grade_summary)
shiny::runApp()
